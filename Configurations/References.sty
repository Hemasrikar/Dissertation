%% Bibliography %%
\usepackage[
	backend=biber, % Use Biber for bibliography compilation.
	citestyle=authoryear, % Style for in-text citations.
	bibstyle=numeric, % Style for the bibliography.
	sorting=nyt, % Sort references by name, year, and title.
    natbib=true, % Enable natbib compatibility.
    uniquelist=false % Display only the first author (e.g., Author et al., Year).
]{biblatex}

\setlength\bibitemsep{1.5\itemsep} % Increase spacing between bibliography items.
\setlength\bibhang{0pt} % Remove hanging indent for bibliography entries.
\addbibresource{Bibliography/Bibliography.bib} % Load the bibliography file.

% Configure citation style to include both author and year prominently.
\ExecuteBibliographyOptions{maxcitenames=1}
\DeclareFieldFormat{citehyperref}{%
    \DeclareFieldAlias{bibhyperref}{noformat}%
    \bibhyperref{#1}%
}

\DeclareFieldFormat{textcitehyperref}{%
    \DeclareFieldAlias{bibhyperref}{noformat}%
    \bibhyperref{%
        #1%
        \ifbool{cbx:parens}
        {\bibcloseparen\global\boolfalse{cbx:parens}}
    {}}%
}
    
\savebibmacro{cite}
\savebibmacro{textcite}
\renewbibmacro*{cite}{%
    \printtext[citehyperref]{%
        \restorebibmacro{cite}%
        \usebibmacro{cite}%
    }}
    
\renewbibmacro*{textcite}{%
    \ifboolexpr{
        ( not test {\iffieldundef{prenote}} and
          test {\ifnumequal{\value{citecount}}{1}} )
        or
        ( not test {\iffieldundef{postnote}} and
          test {\ifnumequal{\value{citecount}}{\value{citetotal}}} )
    }
    {\DeclareFieldAlias{textcitehyperref}{noformat}}
    {}%
    \printtext[textcitehyperref]{%
    \restorebibmacro{textcite}%
    \usebibmacro{textcite}}%
}

% Hyperlink settings.
\hypersetup{
    bookmarksnumbered, % Enables the chapter and section numbers within the PDF bookmarks.
	colorlinks=true, % Enable colored text for links.
	urlcolor=reflinkcolor, % Color for \url and \href links.
	linkcolor=subseccolor, % Color for internal links (e.g., \nameref).
	citecolor=maincolor, % Color for citation links.
}

% Add a "." after the number in the PDF bookmark.
\def\Hy@numberline#1{\ifHy@bookmarksnumbered{#1.\hspace{0.3em}}\else#1\fi}


\DeclareFieldFormat{labelnumber}{#1}
\DeclareFieldFormat{labelnumberwidth}{#1}


% Continuous vertical line with numeric labels on the left
\usepackage{eso-pic}
\usetikzlibrary{calc}

% Adjust positions
\newlength{\biblineoffset}   
\setlength{\biblineoffset}{3cm}   % vertical line position
\newlength{\bibleftmargin}   
\setlength{\bibleftmargin}{1.4cm} % where bibliography text starts

\defbibenvironment{bibliography}
  {%
    \list
      {\printtext[labelnumberwidth]{\printfield{labelnumber}\adddot}}
      {%
        \setlength{\labelwidth}{1.5cm}% width reserved for numbers
        \setlength{\labelsep}{1.25cm}% space between number and line
        \setlength{\leftmargin}{\bibleftmargin}% text starts here
        \setlength{\itemindent}{0pt}%
        \setlength{\itemsep}{\bibitemsep}%
        \setlength{\parsep}{\bibparsep}%
      }%
    % Draw vertical line
    \AddToShipoutPictureBG*{%
      \begin{tikzpicture}[remember picture,overlay]
        \draw[line width=0.6pt, draw=gray!90]
          ($ (current page.north west) + (\biblineoffset,-1cm) $)
          --
          ($ (current page.south west) + (\biblineoffset,1cm) $);
      \end{tikzpicture}}%
  }
  {\endlist\ClearShipoutPictureBG}
  {\item}
